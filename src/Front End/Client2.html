<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container vh-100 d-flex flex-column justify-content-center align-items-center">
    <h1 class="mb-4 text-center">WebSocket Chat</h1>

    <!-- Chat Log -->
    <div class="card w-100 mb-3" id="chatLog" style="height: 50vh; overflow-y: auto;">
        <div class="card-body" id="messages">
            <!-- Messages will be appended here -->
        </div>
    </div>

    <!-- Server Communication Log -->
    <div class="card w-100 mb-3" id="serverLog" style="height: 10vh; overflow-y: auto;">
        <div class="card-body" id="serverMessages">
            <!-- Server messages will be shown here -->
        </div>
    </div>

    <!-- Username Input -->
    <div class="input-group mb-3" id="usernameInputGroup">
        <input type="text" id="usernameInput" class="form-control" placeholder="Enter your username">
        <button class="btn btn-primary" id="setUsernameBtn">Join Chat</button>
    </div>

    <!-- Message Input (hidden until username is set) -->
    <div class="input-group" id="messageInputGroup" style="display:none;">
        <input type="text" id="messageInput" class="form-control" placeholder="Type a message">
        <button class="btn btn-success" id="sendMessageBtn">Send</button>
    </div>
</div>

<script>
    let socket;
    let username = '';

    // Function to append server communication messages
    function appendServerMessage(message) {
        const serverMessageDiv = document.createElement('div');
        serverMessageDiv.textContent = message;
        document.getElementById('serverMessages').appendChild(serverMessageDiv);
        document.getElementById('serverLog').scrollTop = document.getElementById('serverLog').scrollHeight; // Auto-scroll to bottom
    }

    // Handle setting username and joining chat
    document.getElementById('setUsernameBtn').addEventListener('click', function() {
        username = document.getElementById('usernameInput').value.trim();
        if (username) {
            // Establish WebSocket connection with username as query parameter
            socket = new WebSocket(`ws://localhost:8080/chat-socket?username=${username}`); // Connect to WebSocket with username
            setupSocket();

            document.getElementById('usernameInputGroup').style.display = 'none'; // Hide username input
            document.getElementById('messageInputGroup').style.display = 'flex'; // Show message input
        }
    });

    function setupSocket() {
        socket.onopen = function(event) {
            appendServerMessage("Connected to server as " + username);
        };

        socket.onmessage = function(event) {
            appendServerMessage("Message from server: " + event.data);
        };

        socket.onclose = function(event) {
            appendServerMessage("Disconnected from server.");
        };

        socket.onerror = function(event) {
            appendServerMessage("WebSocket error: " + event.message);
        };
    }

    // Handle sending messages
    document.getElementById('sendMessageBtn').addEventListener('click', function() {
        const message = document.getElementById('messageInput').value.trim();
        if (message) {
            socket.send(message); // Send message to WebSocket
            document.getElementById('messageInput').value = ''; // Clear input
        }
    });
</script>
</body>
</html>
