<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Chat Test</title>
</head>
<body>
    <h3>Chat Messages</h3>
    <div id="chatBox" style="border: 1px solid #000; height: 300px; overflow-y: auto; padding: 10px;">
        <!-- Messages will appear here -->
    </div>

    <script>
        // Function to display a message in the chat box
        function displayMessage(sender, message, timestamp) {
            const chatBox = document.getElementById('chatBox');
            const messageElement = `
                <div>
                    <strong>${sender}</strong>: ${message} <small>(${timestamp})</small>
                </div>`;
            chatBox.innerHTML += messageElement;
        }

        // Fetch messages from the backend and populate the chat
        function populateMessages() {
            fetch('http://localhost:8080/messages')
                .then(response => response.json())
                .then(messages => {
                    messages.forEach(msg => {
                        let parsedMessage = msg.text;
                        if (parsedMessage.startsWith('{')) {
                            parsedMessage = JSON.parse(msg.text).text;
                        }
                        const formattedTime = new Date(msg.timestamp).toLocaleTimeString();
                        displayMessage(msg.username, parsedMessage, formattedTime);
                    });
                })
                .catch(error => console.error('Error fetching messages:', error));
        }

        // Call the function to populate messages when the page loads
        window.onload = populateMessages;
    </script>
</body>
</html>
